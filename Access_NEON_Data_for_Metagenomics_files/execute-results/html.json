{
  "hash": "0fd31f9ad34d5013bb8db515ceb91094",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Access NEON Data for Metagenomics\"\n---\n\n\n\nFrom [Access NEON Data for Metagenomics](https://www.neonscience.org/resources/learning-hub/tutorials/neon-data-metagenomics)\nSee \n* [Update on the changing NEON microbial data](https://www.neonscience.org/impact/observatory-blog/update-changing-neon-microbial-data)\n* [Soil microbe metagenome sequences](https://data.neonscience.org/data-products/DP1.10107.001)\n\nInstall packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninstall.packages(\"neonUtilities\")\ninstall.packages(\"neonOS\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(neonUtilities)\nlibrary(tidyverse)\nlibrary(lubridate)\nlibrary(DT)\nlibrary(viridis)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsoilTrialSites = c(\"BONA\",\"DEJU\",\"HEAL\",\"TOOL\",\"BARR\")\nsoilTrialSites = c(\"HARV\")\n\n\nsoilChem <- loadByProduct(\n  dpID='DP1.10086.001',\n  startdate = \"2017-01\",\n  enddate = \"2019-12\",\n  check.size = FALSE,\n  site = soilTrialSites,\n  package='expanded')\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nView(soilChem$sls_metagenomicsPooling)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmetaGdata <- loadByProduct(dpID = 'DP1.10107.001',\n\n                          check.size = FALSE,\n\n                          package = 'expanded') \n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmetaGdata_mms_metagenomeSequencing <- metaGdata$mms_metagenomeSequencing\nwrite_csv(metaGdata_mms_metagenomeSequencing, \"data/NEON_metadata/metaGdata_mms_metagenomeSequencing.csv\")\n```\n:::\n\n\n\n\nThis has HARV data collected up until 2022. The 2021 and 2022 data are not in the phyloNEON data. \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmetaGdata_mms_metagenomeSequencing_HARV <- metaGdata$mms_metagenomeSequencing |> \nwrite_csv(metaGdata_mms_metagenomeSequencing_HARV, \"data/NEON_metadata/metaGdata_mms_metagenomeSequencing_HARV.csv\")\n```\n:::\n\n\n\n### Read in saved file (all above in eval = FALSE)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmetaGdata_mms_metagenomeSequencing <- read_csv(\"data/NEON_metadata/metaGdata_mms_metagenomeSequencing.csv\")\n```\n:::\n\n\n\n### Create data frame from dnaSampleID\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmetaGdata_dnaSampleID <- metaGdata_mms_metagenomeSequencing |> \n  select(dnaSampleID)\n\n# Read in 2023 and 2024 data that is not in the metagenome data product yet\n\nneon_ay23_jgi_samples <- read_csv(\"data/NEON_metadata/neon_ay23_jgi_samples_soil.csv\")\nneon_ay24_jgi_samples <- read_csv(\"data/NEON_metadata/neon_ay24_jgi_samples_soil.csv\")\n\nneon_dnaSampleID <- rbind(metaGdata_dnaSampleID, neon_ay23_jgi_samples, neon_ay24_jgi_samples)\n```\n:::\n\n\n\n#### Full table\n\n\n::: {.cell}\n\n```{.r .cell-code}\nneon_dnaSampleID_split <- neon_dnaSampleID |> \n\n  separate(`dnaSampleID`, c(\"dnaSampleID.site\",\"dnaSampleID.sub\"), \"_\", remove=FALSE) |> \n  \n  mutate_at(\"dnaSampleID.sub\", str_replace, \"-comp\", \"_COMP\") |>\n  mutate_at(\"dnaSampleID.sub\", str_replace, \"-COMP\", \"_COMP\") |>\n  mutate_at(\"dnaSampleID.sub\", str_replace, \"-GEN\", \"_GEN\") |>\n  separate(`dnaSampleID.sub`, c(\"dnaSampleID.sub\",\"dnaSampleID.type\"), \"_\") |> \n  \n  mutate_at(\"dnaSampleID.sub\", str_replace, \"-M\", \"_M\") |>\n  mutate_at(\"dnaSampleID.sub\", str_replace, \"-O\", \"_O\") |>\n  separate(`dnaSampleID.sub`, c(\"dnaSampleID.plot\",\"dnaSampleID.sub\"), \"_\") |> \n  \n  mutate_at(\"dnaSampleID.sub\", str_replace, \"M-\", \"M_\") |>\n  mutate_at(\"dnaSampleID.sub\", str_replace, \"O-\", \"O_\") |>\n  separate(`dnaSampleID.sub`, c(\"dnaSampleID.layer\",\"dnaSampleID.sub\"), \"_\") |> \n\n  mutate_at(\"dnaSampleID.sub\", str_replace, \"-201\", \"201\") |>\n  mutate_at(\"dnaSampleID.sub\", str_replace, \"-202\", \"202\") |>\n  mutate_at(\"dnaSampleID.sub\", str_replace, \"2013\", \"_2013\") |>\n  mutate_at(\"dnaSampleID.sub\", str_replace, \"2014\", \"_2014\") |>\n  mutate_at(\"dnaSampleID.sub\", str_replace, \"2015\", \"_2015\") |>\n  mutate_at(\"dnaSampleID.sub\", str_replace, \"2016\", \"_2016\") |>\n  mutate_at(\"dnaSampleID.sub\", str_replace, \"2017\", \"_2017\") |>\n  mutate_at(\"dnaSampleID.sub\", str_replace, \"2018\", \"_2018\") |>\n  mutate_at(\"dnaSampleID.sub\", str_replace, \"2019\", \"_2019\") |>\n  mutate_at(\"dnaSampleID.sub\", str_replace, \"2020\", \"_2020\") |>\n  mutate_at(\"dnaSampleID.sub\", str_replace, \"2021\", \"_2021\") |>\n  mutate_at(\"dnaSampleID.sub\", str_replace, \"2022\", \"_2022\") |>\n  mutate_at(\"dnaSampleID.sub\", str_replace, \"2023\", \"_2023\") |>\n  mutate_at(\"dnaSampleID.sub\", str_replace, \"2024\", \"_2024\") |>\n  separate(`dnaSampleID.sub`, c(\"dnaSampleID.subplot\",\"dnaSampleID.date\"), \"_\") |> \n\n  unite(plotID, c(dnaSampleID.site, dnaSampleID.plot), sep='_', remove=FALSE)\n\nneon_dnaSampleID_split$dnaSampleID.date <- as.numeric(neon_dnaSampleID_split$dnaSampleID.date)\nneon_dnaSampleID_split$dnaSampleID.date <- ymd(neon_dnaSampleID_split$dnaSampleID.date)\n```\n:::\n\n\n#### Full table\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmetaGdata_mms_metagenomeSequencing <- metaGdata_mms_metagenomeSequencing |> \n\n  separate(`dnaSampleID`, c(\"dnaSampleID.site\",\"dnaSampleID.sub\"), \"_\", remove=FALSE) |> \n  \n  mutate_at(\"dnaSampleID.sub\", str_replace, \"-comp\", \"_COMP\") |>\n  mutate_at(\"dnaSampleID.sub\", str_replace, \"-COMP\", \"_COMP\") |>\n  mutate_at(\"dnaSampleID.sub\", str_replace, \"-GEN\", \"_GEN\") |>\n  separate(`dnaSampleID.sub`, c(\"dnaSampleID.sub\",\"dnaSampleID.type\"), \"_\") |> \n  \n  mutate_at(\"dnaSampleID.sub\", str_replace, \"-M\", \"_M\") |>\n  mutate_at(\"dnaSampleID.sub\", str_replace, \"-O\", \"_O\") |>\n  separate(`dnaSampleID.sub`, c(\"dnaSampleID.plot\",\"dnaSampleID.sub\"), \"_\") |> \n  \n  mutate_at(\"dnaSampleID.sub\", str_replace, \"M-\", \"M_\") |>\n  mutate_at(\"dnaSampleID.sub\", str_replace, \"O-\", \"O_\") |>\n  separate(`dnaSampleID.sub`, c(\"dnaSampleID.layer\",\"dnaSampleID.sub\"), \"_\") |> \n\n  mutate_at(\"dnaSampleID.sub\", str_replace, \"-201\", \"201\") |>\n  mutate_at(\"dnaSampleID.sub\", str_replace, \"-202\", \"202\") |>\n  mutate_at(\"dnaSampleID.sub\", str_replace, \"201\", \"_201\") |>\n  mutate_at(\"dnaSampleID.sub\", str_replace, \"202\", \"_202\") |>\n  separate(`dnaSampleID.sub`, c(\"dnaSampleID.subplot\",\"dnaSampleID.date\"), \"_\") |> \n\n  unite(plotID, c(dnaSampleID.site, dnaSampleID.plot), sep='_', remove=FALSE)\n\nmetaGdata_mms_metagenomeSequencing$dnaSampleID.data <- as.numeric(metaGdata_mms_metagenomeSequencing$dnaSampleID.date)\nmetaGdata_mms_metagenomeSequencing$dnaSampleID.date <- ymd(metaGdata_mms_metagenomeSequencing$dnaSampleID.date)\n```\n:::\n\n\n\n### Plot of HARV samples per plot per year\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nneon_dnaSampleID_split |> \n  filter(dnaSampleID.site == \"HARV\") |> \n  group_by(Year = lubridate::year(dnaSampleID.date), dnaSampleID.plot) |> \n  count() |> \n  pivot_wider(names_from = dnaSampleID.plot, values_from = n) |> \n  mutate_all(funs(replace_na(.,0))) |> \n  pivot_longer(!Year, names_to = \"plot\", values_to = \"metagenomes\") |> \n  ggplot(aes(x=Year, y = plot)) +\n  geom_tile(aes(fill = metagenomes)) +\n  scale_fill_viridis(discrete=FALSE, direction = -1) +\n  scale_x_continuous(breaks = seq(2013, 2024, by = 1)) \n```\n\n::: {.cell-output-display}\n![](Access_NEON_Data_for_Metagenomics_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n\n\n### Plot of samples per plot per year at all sites\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nneon_dnaSampleID_split |> \n  group_by(dnaSampleID.site, Year = lubridate::year(dnaSampleID.date), dnaSampleID.plot) |> \n  count() |> \n  pivot_wider(names_from = Year, values_from = n) |> \n  mutate_all(funs(replace_na(.,0))) |> \n  pivot_longer(!c(dnaSampleID.site, dnaSampleID.plot), names_to = \"Year\", values_to = \"metagenomes\") |> \n  ggplot(aes(x=Year, y = dnaSampleID.plot)) +\n  geom_tile(aes(fill = metagenomes)) +\n  scale_fill_viridis(discrete=FALSE, direction = -1) +\n  facet_wrap(~dnaSampleID.site, scales =\"free_y\", ncol = 3) +\n  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) \n```\n\n::: {.cell-output-display}\n![](Access_NEON_Data_for_Metagenomics_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "Access_NEON_Data_for_Metagenomics_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}